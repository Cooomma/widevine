package widevine

import (
	"testing"
)

func TestGetContentKey(t *testing.T) {
	options := Options{
		Key:      key,
		IV:       iv,
		Provider: "widevine_test",
	}
	wv := New(options)

	contentID := "testing"

	// Make the request to generate or get a content key.
	policy := Policy{
		ContentID: contentID,
		Tracks:    []string{"SD", "HD", "AUDIO"},
		DRMTypes:  []string{"WIDEVINE"},
		Policy:    "default",
	}
	resp := wv.GetContentKey(contentID, policy)

	if resp.Status != "OK" {
		t.Error()
	}
}

func TestGetLicense(t *testing.T) {
	options := Options{
		Key:      key,
		IV:       iv,
		Provider: "widevine_test",
	}
	wv := New(options)

	contentID := "fkj3ljaSdfalkr3j"
	resp := wv.GetLicense(contentID, testLicenseChallenge)

	if resp.Status != "OK" {
		t.Error()
	}
}

// Test Challenge simulating a request from a Widevine CDM payload.
// https://demo.unified-streaming.com/video/tears-of-steel/tears-of-steel-dash-widevine.ism/.mpd
const testLicenseChallenge = `CAESrSsSMAouChgiEGZrajNsamFTZGZhbGtyM2pI49yVmwYQAR
oQnG3utTMYA/nd0yHBx2bEGBgBILnj2uUFMBVC7ioKEnN0YWdpbmcuZ29vZ2xlLmNvbRIQKHA0VMAI9j
YYredEPbbEyBqwKN216h/ld8hkrk5yQEDSgh9FFH2PtN/OJaGD983qRFNtwCgaUziQKWQ/HKoUpN3xC3
Jl2fFv5LwUqzTdPYOpbUyocpRrYWZQu87Ix3RYIjVedEuqKgxttxHn4/TQJcKIGFPs7HbaWVYlMXHySG
U5pAylNUqpsceC+QuUH1AwREXv+EPZQAyJelI16sOJsK3s5oMypKColb4fYnJslvBCc8UbYEII4HU+Bv
r5x3eoUwaVLGkyLfnEpwoYuyGXHDzoi+spyE/Ykp20u6nGYk99/dvyRp5JUv0YGoy9u4FLuhrj1IXrXh
BJFh9sMBlrkMZSPCjbAd7AKFZmY4+FjNRLpZoK1mnlbSYyOIjhI6qyYqRTN2lAabxXlF6eBg7be00noL
kFUPTDRQrFJMWhlo0KZ5rXsHCAM0btJSPl3ke080k/wpq40+gwYUMjMhXTmv9NnzM0x2luO8hhT+sgk5
NXsCaE2Ym90kTcEpDeSvwgwJ8cSyWo38WnXjv7DUOZXIBRRu9+G9aZDoDLTA1wFa9F/yRxT09E4Mxzcj
q5agFUZqbpl0p1A0Wo4MxGlVPpkrs8GrODXfAuG2M6R8rg87jmSkJwpOLPgkhI1UY9/nJy575oLgsx7R
h17lxsflvNuMyystip5DelTHtHwrcLV1cBhO+rOfGZ5y/XTEkdJb//Wbym2tpIvK2ZFN2fvcsPcohuNe
1Y25ZH50mCvKjD+dMS5E7rLpWXdh4cdomfKt/atyV9o1rchYIhWh5ubZFix2NaujCNJ2UbrQcHZ1QCdq
zCbvBepQyFDPkzaGPAF1lRtC/gHF+AdAnbuw+HsjjDo9O8DNVkU4Zi3+96fjxmEM8bj3iFe2c3Z11QBU
HdUNuNKZ/r51fyx7Lhiw9X2IwGPx/hkajl3R0kgfZouORsyHErtsoEYxgi8mIqEvQJJTVkxWMCP0aXvR
Q2vL8Mq85UG4m0T514rjbgW4oEspiLGaAyZ5H6UpmgLfa8zjcU5JJWXuk176GJ60fPevfa8k+Y51DCIt
Fqd8lXyeeBV+FnQ3WpR9RlhFUbOin3J0BDLuoFcavTWQ9/05X5LmkSUF2w/VXh0LLFE8FaDtxCewxfuU
ryQd27TloJZh/ZZjI2LC4jJQXJ5XTtNk+QNxQGiKPd+3GDpA/H+mQCMqVe6PWbPShMeItq45ETXTywFs
EH9sF/bEpWCSf59CSWNEbTg2/U8dyZuzQq3cu+4Xcgf29LyY6d45gw0KWZBCMvfMT1tPgYARlnCiqxmO
cGx0IA9pYuye6Sz27QaUewXnDm0Fd8KoWc8kjca5jdpQ9x9edCXJ5BWbiiSRgJ2iKUlbIH72zQ0PDVLI
0QuU8MYsIhRb3neQGvV6xK3I+NN9lcfavZkMtKsx4evQJ1YHzQ9p1xZCx4h22THNgp0S0C+7DhCWOVVD
lv7NIa3AKGrYrnKxGIVuQbmo4OVH73c8BgXVhUElM0ibsDoU8Q4rDv37KI0MjUtDLZGJIg5gFq/qf5oT
y843IJUPET1eHccPYKyvMozCBVvPTtIMEq6ytn9cw09eZ/ZI5RdvzgWwdmGKdihUvpNBT9UKAjjEJtgn
UG+e8KlLGvisXf+WayfgseK9/SV9epPH812dciGIfslA8dyPE4PTUhMx7xQByJqyfIPIs4HqLbldmh7+
3tu5yWm1cV+ETQsLPjDYqCUMwaswQ/a190iCwlw2HI2z3nX2dNFfWFPEK0oM9sNTY7EEX98K5Z78lyku
1MLURvrOSPfqkiA7th8wtHWNvijFHcjNNWJClDiWiiE/ZDdExU2MMsfQNEa3bnFLhNs57f+FqzaO0wxL
+uJ+7xDMInsMS4vDmdHBT1nKHehlT2+vU/QSDOmchPZfbFL/gCU//PgmowZ/jN2aLytEu7Y16Li5vKNG
xSt2t11P2zf0Q3v6l0jEVuhJ6MU+5rZ4uSZ75a74J2jdZc4TGej4RiP/ym9wFlsYofgZgIUH5CYDS278
HSuYpOCd+Jc8oiQIXQK5KyUp2F+vBvUMcyolrKPz0ssHYFvCVb6cEeNYDM2M4CcMCDEH7VZN8UvG4yso
NCXKz6LYpYQVFHs1KuEsVLv5kCH9J5Lhly93Z7eIBPVIeFsPILwE5Sb/9uY+xReMNILRDtPjITJGHLPt
/KlikTHgBHG9GnobJlBIJcueELclCbhI5BfiekgGbOPkIKS8H4GUAin/XaCzou7DB5iVlC2XkIrlaLsh
7K+tmxQqhaGps7JUjCYNJJBstOzE9EQ2VGooKI3/Jrw/qaUFBc66cp/yZjpfE1dclf1rZppQzw2wqWuY
PHvwVIg37CjiiA4zV9El8RQAOoNHNFx5rM81cUhQRVGIypF0ta1MBrDmBXxKFj/jxNnU9YN9RbDC/YiO
ZpNZSxSYoEwieFg0ycO7H8T9giq4mZYifHIdiM0l7dli3sFOriqsZIYKLDNymJWXXLfwJ/6GW0VWggOz
YBdHw8RGz6rVBA+yTLCr67BFO/S5hKU7DXUK5UWK8nfYobQhh1HiWSnmHIznLrcfrMjTDdjIV88nSM0B
qnUCIaAN7Pr65UhMT36juiHVl4xIZ3atTp2OoTsHJFWavIKOltRiyD4EqMg6itIlfTn0ZDsBBh8rTqyH
08sINSaodUY7ImliGwoRMXeIc2KAmwWL2XyP5jfQcnpXXCp41Bf/fd8xi5DpdwghsPkh5zZRx8AWBy/m
OAIxSWCQGxsguVpun35o3gza9KqDKL1ZXDMy3y5JD0Y8PAjcLFAFFgXw1QI4FNEwMpGKZgrOTs6m4w9K
uNCWItZ8WTFvxNkUjx9JZ3ptVtHdPR5bYArj7IqfHXirN+zdrH4ujBTx+KmCOruLAEd1W3pL19zzWEkx
miDd3Tau+RCPVid2L1TOlSHRpdTpI1l+zifYSFfvB4s5Jz/B6UTbz5VQ+PwJ9iiRBFBkUFC2Yg38zjhz
+/kmdVGwMgsTfEWjbWeMB5z+93T3GCDAUGVl/VeKAFdVNEHEqxtx1z40SAu/Z8W7Y0Va42yVPyCv6Y79
gqZmhFgpTlnSX8HF50HDqU/9mmswGLp9l+iGMPvmseBDDUy5aJt3ZFPjsd8tFL1LycLGNwZXloJdpdyX
8faQl2exa4fz7+kp+3lXppHsbjPxdNQMnXXdoVdX98QMP3RObFtrCbuIyjuD8V64TXWmtDMN76kP3AxG
3i71dL40wSIiLMtYCuRYZjv5XBFpFhRAyryNvPBsKzFfHVnsvlhjKLqix6ig8FNKibcjAwb704AO6FMd
546usCYawqz1M7iOhTe652zyw/T4vKAug0cv/MEcCNgCnSywWFCOmNTul2qBA5bakhiDCJwpV8hJ8bXq
5iUZVEKZZcqgZ4mBuN3MXEVuZmA63s4C1LseW29VXKp6QzgSwPw8Z+oxP4IV07p2nXOcscC5b1t5f9Bz
7iHFpxibNIYA1Tzz1qchnSy9c/Q9F9Q0UcctOI0w0uWc7BrXeSM6MbtsGE8aiWFVTw98HfPE+hmwkQnv
bF3S1lKOWYwZ/nl3F1U64zoq1LlmHGcCJLL5seZG1Wm9eTLm3plsabbXKu4O9PqEleFd2lIIzCYIMHMe
Ql41+HhekvgYBdd5X/I/tv5FmmmnSCoJ6eggVUq9u646gKo442Fe0a79IlCrXURLw9QcHsbRipXFHxqp
eCR2tZyW7W75m9KA1TmWLEhYIRh/8+xWC4y1XhSmUwp2brvGzeknLEjHIDrVbBPf9bTF63z0VwkK0Zic
1K9SeaxUM20k6Wjpsi9/qKKv+0ZP7gwXWThoE3yqaWAornNtrz+FK434CQy2KAkrTBB+0JfvdmLY/2hR
CF8B1mV4gpIc26TLXuBralRq1q49FU3aZSJEX0tbVgC5CAQPb/RezDwpU8nFGJRobpE1yAeLP3Z3q4d9
T+jpxk1LVC+UJaOSE3ODgygRcwwTjW7Ux2V+Twf2ED3yBAVudUzQNysdVHzpcZna54hfNa1SG5LCA9Dh
sAFuW8++/koaYFMRM1WPH+I+fDjyXIpfGVajl1v0qQZJM+FTIYIxG3w3aqMLMvPmup49Hqwu9IssemKm
7JaZRP44j27LW2VLaCO1ewK39m51epswmRp4TslKYEwJFoX7jO5/C05IcN4/yKxfVSdPf/Yr9wFx5ReW
s1kDCXzT9TzCJVxwPN091oLk17SaRkG79VLPqLhsxDNFoiNf8hTVIaUyDD6oVozXE15J77/DAq2/MKBn
Jerle2Xj6Z/3F7Fq9gj9Q28oyzGqU9VBQXldNaTjgALh99Mma94IRiiP9M+h42W6eNU1Q+nv9dSt0jZ+
H0o8CUylSt3cz1UCbmONXFsTZJ/WxzeZzRHLajgJh1b4vL8goVrgoNeGanCqQfAcjU+fzUwNQJtK8l6P
XmtJx9bMFgfUbmK4brRjnEM6D9YwHzNrpT59et4M9mx+Ddn+3mE4Jy1w/vS6jKpjtiR0RT3HQ27YBaX1
8mhIbbRcHiQfPrBGNQhU0k3m5+JTypUocTC41QjbvsuESUiWGbAMPyx32qZYZlfk+vctLk1wOEyRaqtQ
+6H4Cs3PL22imJa44TiDtsIgTPLW8ORssvWcx7Ztsg1ueIOa/E9107cNErBtaJEefOcVv4p5gMIcyZB2
mud4+B3tp+Z5a4sgaICK62ESvsSQOqD/mqQFMiuXq5oAQL/yzYMakap0uK2DBOr4kFC6TmXwRTNwSIpA
hhG9g3eSQm+KUhbjE0GFwrhcWZNekrKNyWxJoBozVRIVGh+ChjVowPVCjBOyQUdRNhnAEd3qDoJrTAM5
SzbENNcs2ediiC3WpvwgXNDNkHrXklt09gShtJgrK3gXLlZsExJiSwk0wc0qr7sf/rQt/6S3ZrG2FgrS
2h6c542V7f+ZamPb0b8k5DUGbRupATwzl79pzuSqOVlPSHBWSA8gDOS3cakDgNThgC2292GQjU/PuAkD
43hAWeZIFVY7j3UuFxfefL4H1oBYOz9IjySM7gzviUWgqgiFL9v7LfrUSNSisoMQAimgc5Ywdl5G4Qvj
B+swoBPzllxxXOh4xw118PNcBeDK06Rrll1Led58/8P2+wtOwIGFJGMAw8XuhRgD5Yx5J6BZvnyKjI5A
rotlGFZXaRF2iJNP36OjONLm0YvuObrMs7l8Hb6kApZUJyDKxVDEO9HWgxCTfQbze/0md4x6XM4/BzD2
ncj7b8UXVbBgE9bpZbSSY2JDpN3wgaBqJTPzfh5VHEVmaa6W/o9Pe9HFNL+66vQqIcHzlTS+/p6HMhGl
tsOcMMxRrR/LQVHaqijd04rzQErzVdu8rag6iJsxgqTSzVzMCVDC3FEmmZyMc6A1He6ngMwhzDKBDeua
lzdksw3bj7pjnDi5LFDZng4sIstzwlhcwpparLTYFLQbMhnzWRfZeCGJCRx/BPXRMeJaS101iLSBN8K6
xySgegunSONv14e0hI6aseSPOzL+Uj58VrLbjb5soaJlBu6n+nVObxSSA7fB17SzqTpFnhzkaIDMurZO
wwi4qn+MJkuhNQWTqqSWxc5dF3ESFhuSbHJ1CWGj2Gxf6ee4GpPAfQYQ/sgnPm6uOvL8ECfLGw0Y2299
79EDp+S60/ZCv95gzceTH1Cx2rRrZ9nWgVVTHhQFmlXSE05Zc2SgMmX6HvUsj88reeujqv67HIZI8CML
abgkaElWD1fyyO2bmQ1lqQyo+h8dTG22i+RgI4QKeZNgXL724/krOxA5wN9JSMqBaOqdTPS4lg439hBu
y9o9J62Oa+K6M+OdPycX7fLW6vqBmu8tg6eRSjbJFhUoNFNdzySAF4VLQMb3yHMLvr5S65vQqbefIVi1
T7vkyMQ87ZnNWTQ+IXMDU3t0Qakc08TSJluIfQvPvWrPGk43bziwrNmQvq9/t5kzpUfj3c3N1moCTLi4
oRejZOSmrh2WwONqH0rV45yGnTtYmn6fGj/R+PCRmV2yu9LDglTk7hSf8FCrx05Tf45vYhzyGZZwqYOS
yR1C1Mtk6t6eJoUaNs/mefUvEcIbhpReY5RcX3Db40HVIsHuvEDqNMCJ0eMXj4KO+3FYPwmdApcdlfXL
vqPIQZJWzjfVQ9zvGsoA5idKcdcON9IeOd2pEDft6LTisWNzBNr4urtTpR9n9+xuqj3gFcW/vo6YrkHK
Kns5nnT/W8F1zMqyXcJLse+bn+buDpt/hJ0JcBpvk3bxgS5yvoLm9AYX1dDU7jvK09xP9k95LfsZAbZ4
9e3snkyTZUiTlTmoNdIabPRimxwG4y2ZD5kR7YRS1yyJHq3aQ2IKx4hFdekPZBQ+z/VE8mJNnAXJ+MWG
4spGVuOy+ujJeEAoNeHVcAKJ2qlgy4ivxuyJE2VSr587ELSbwek3xaKQtrj8o1EBiMy9Am6c4lBtU/RP
/+ExFWlAWF3AW5NplKMCP1l7JLyX2IyUBtCmhd5iOcqKzQ3osm9beBSwZyswPwMebzIcAe7YOWTk/gGP
eIZFjZHugwdu7ijUBke80iVt+y+CbHoJ1LW4g5rt8WDIyt1S2AI5xRYtlDHMHxN3lXBGmnRDqR9+vRxT
aYrzGcdE2L3VAr3hbUSbBDA9Tkufw+Q/rxO0JVjrJhOKkTesEIB1N5CLaaIfkHtdEv8Jy/A/a4IiquXq
iJq5YB+uU4C9cMtdpgl2qVnEGi+GghvIjv/VbouWare81hTcYAB7Z1JrTdIsxj738b5Y5DY8Sy1rHd5n
xY+1aHx88uDZjEMOTaaggA9WTFz+PHMz95lYHGmuTbLq6zz9KvnSqS2Den5xfEcHyU9SxLZGVMKYrgqs
qp0E395tXNQ3idupSbxZoEwXSoHfFWUxsFEX6F1mT3lfqC1bzYc8Ivy+b+g9gcbS9uYiqokEv97OCrpF
9D19bO1yiHogoZMDQRAZEIGAUVIhDDQYBk1rEcEkcA/R1FI9ZKKoACqxnnewaryrWle2HPVFLCbH5C2b
SqHsDCoY7Eb/PR93opdOO75eHtcWryGewM9OqaM21tA8zuduxpafVByv5w7P6bmRVcpogevhhDr33XZn
h2PbImLzHiE9d2Av3Ct7oMv7W0zTL3t2qV9tqcFpL7qC6gqhW+O7itlRz5ujWeymFzMxNygA6QQzUUq0
fLH0WlHk1BlFSVTyNUhtELkbDscvLNLC24D/fFZOR/9NDzHODs6oMfexmcifqqBUpQbP2c1ykZQgR/x3
i8wLUDDf064dbNPiLsAZ5DBXcK40CKxr4M/kF+iJ/qEDKuBgclgJlHpB9XwuO7K6aej6LJ6AAwdRqAAq
6qQQ6B8Qp/cJ3+CZiI3gNGW+Or8mcVf58VrhIgKRGi3nVCTWpbydEUkVLK6l7X0/LG9bupejDyELU7XW
k2N1uuClFdQMJXmKwOsR05uFLfG7e2o6TOyrwoUI1uGvnx2FiDLboZqbB26LCUbg9Ifc5sYo2oOoaoAi
6O++8fWueruGurWaxwli8AD1ExalxrjRpZXl3KWexrWw+7i02ed865bhyfVqKbmWUw2e35Vti2jPwLfX
7N0SWy5nNn5dI1PsTR0Frtpu2MDN5zMJs33drghhwCDNVZN1oI0uML8IC781FIsKUx27L1K5WaUZcGkL
ivS6OhFEvVFca8+dLLmwA=`
